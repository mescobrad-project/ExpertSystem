from sqlalchemy.orm import Session
from uuid import UUID
from src.controllers.WorkflowController import WorkflowController
from src.models._all import WorkflowModel
from src.schemas.WorkflowSchema import WorkflowCreate, WorkflowUpdate
from src.utils.workflow import parse_xml
from ._base import (
    random_lower_string,
    random_unique_string,
    random_dict_obj,
    random_bool,
)
from .WorkflowCategoryUtils import seed_category


def create_random_workflow(used_xml_times) -> tuple[str, dict]:
    name = random_unique_string()
    description = random_lower_string()
    raw_diagram_data = random_dict_obj()
    if used_xml_times == 0:
        raw_diagram_data[
            "xml_original"
        ] = '<?xml version="1.0" encoding="UTF-8"?>\n<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="sample-diagram" targetNamespace="http://bpmn.io/schema/bpmn" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd">\n  <bpmn2:process id="Process_1" isExecutable="false">\n    <bpmn2:startEvent id="StartEvent_1">\n      <bpmn2:outgoing>Flow_0fxmrky</bpmn2:outgoing>\n    </bpmn2:startEvent>\n    <bpmn2:userTask id="Activity_17z1a6q" name="Get Data">\n      <bpmn2:incoming>Flow_00rwj4h</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_11kbaoo</bpmn2:outgoing>\n      <bpmn2:property id="Property_01axr8m" name="__targetRef_placeholder" />\n      <bpmn2:dataInputAssociation id="DataInputAssociation_1h642dx">\n        <bpmn2:sourceRef>DataObjectReference_19g0qyl</bpmn2:sourceRef>\n        <bpmn2:targetRef>Property_01axr8m</bpmn2:targetRef>\n      </bpmn2:dataInputAssociation>\n      <bpmn2:dataInputAssociation id="DataInputAssociation_0se651x">\n        <bpmn2:sourceRef>DataObjectReference_0xqzh87</bpmn2:sourceRef>\n        <bpmn2:targetRef>Property_01axr8m</bpmn2:targetRef>\n      </bpmn2:dataInputAssociation>\n    </bpmn2:userTask>\n    <bpmn2:dataObjectReference id="DataObjectReference_19g0qyl" name="DataLake Object Storage" dataObjectRef="DataObject_1ywy56n" />\n    <bpmn2:dataObject id="DataObject_1ywy56n" />\n    <bpmn2:scriptTask id="Activity_0jngfnp" name="Pass through Query Builder">\n      <bpmn2:incoming>Flow_18ulu43</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_1vnyey2</bpmn2:outgoing>\n      <bpmn2:dataOutputAssociation id="DataOutputAssociation_0lsmnhs">\n        <bpmn2:targetRef>DataObjectReference_19g0qyl</bpmn2:targetRef>\n      </bpmn2:dataOutputAssociation>\n    </bpmn2:scriptTask>\n    <bpmn2:exclusiveGateway id="Gateway_0oprz0e" name="Get input from Datalake?" default="Flow_0zdmjjo">\n      <bpmn2:incoming>Flow_0fxmrky</bpmn2:incoming>\n      <bpmn2:incoming>Flow_169etc3</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_1hpw9wu</bpmn2:outgoing>\n      <bpmn2:outgoing>Flow_0zdmjjo</bpmn2:outgoing>\n    </bpmn2:exclusiveGateway>\n    <bpmn2:sequenceFlow id="Flow_0fxmrky" sourceRef="StartEvent_1" targetRef="Gateway_0oprz0e" />\n    <bpmn2:exclusiveGateway id="Gateway_1l3e80e" name="Go to Query Builder or Data Analytics">\n      <bpmn2:incoming>Flow_1hpw9wu</bpmn2:incoming>\n      <bpmn2:incoming>Flow_11kbaoo</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_18ulu43</bpmn2:outgoing>\n      <bpmn2:outgoing>Flow_0ts1gcc</bpmn2:outgoing>\n    </bpmn2:exclusiveGateway>\n    <bpmn2:sequenceFlow id="Flow_1hpw9wu" name="No" sourceRef="Gateway_0oprz0e" targetRef="Gateway_1l3e80e" />\n    <bpmn2:sequenceFlow id="Flow_11kbaoo" sourceRef="Activity_17z1a6q" targetRef="Gateway_1l3e80e" />\n    <bpmn2:sequenceFlow id="Flow_18ulu43" sourceRef="Gateway_1l3e80e" targetRef="Activity_0jngfnp" />\n    <bpmn2:exclusiveGateway id="Gateway_0xb1dhn" name="Return to the starting point, finish, or call another workflow?">\n      <bpmn2:incoming>Flow_0q4y4an</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_0a9yp4l</bpmn2:outgoing>\n      <bpmn2:outgoing>Flow_169etc3</bpmn2:outgoing>\n      <bpmn2:outgoing>Flow_14hh9rc</bpmn2:outgoing>\n    </bpmn2:exclusiveGateway>\n    <bpmn2:endEvent id="Event_1b9zwmo" name="Terminate Successfully">\n      <bpmn2:incoming>Flow_0a9yp4l</bpmn2:incoming>\n      <bpmn2:incoming>Flow_1pbasl1</bpmn2:incoming>\n    </bpmn2:endEvent>\n    <bpmn2:sequenceFlow id="Flow_0a9yp4l" name="Finish" sourceRef="Gateway_0xb1dhn" targetRef="Event_1b9zwmo" />\n    <bpmn2:sequenceFlow id="Flow_169etc3" name="Start again" sourceRef="Gateway_0xb1dhn" targetRef="Gateway_0oprz0e" />\n    <bpmn2:scriptTask id="Activity_1psf12t" name="Make an analysis">\n      <bpmn2:incoming>Flow_0byalrt</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_18thxxy</bpmn2:outgoing>\n      <bpmn2:dataOutputAssociation id="DataOutputAssociation_0ps3r04">\n        <bpmn2:targetRef>DataObjectReference_19g0qyl</bpmn2:targetRef>\n      </bpmn2:dataOutputAssociation>\n    </bpmn2:scriptTask>\n    <bpmn2:exclusiveGateway id="Gateway_1ucbubf" name="Do you want to select another file?">\n      <bpmn2:incoming>Flow_1vnyey2</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_1tu1tg4</bpmn2:outgoing>\n      <bpmn2:outgoing>Flow_1eyhqbc</bpmn2:outgoing>\n    </bpmn2:exclusiveGateway>\n    <bpmn2:sequenceFlow id="Flow_1vnyey2" sourceRef="Activity_0jngfnp" targetRef="Gateway_1ucbubf" />\n    <bpmn2:exclusiveGateway id="Gateway_1g3dybt" name="Go to Datalake">\n      <bpmn2:incoming>Flow_0zdmjjo</bpmn2:incoming>\n      <bpmn2:incoming>Flow_1tu1tg4</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_00rwj4h</bpmn2:outgoing>\n    </bpmn2:exclusiveGateway>\n    <bpmn2:sequenceFlow id="Flow_0zdmjjo" name="Yes" sourceRef="Gateway_0oprz0e" targetRef="Gateway_1g3dybt" />\n    <bpmn2:sequenceFlow id="Flow_00rwj4h" sourceRef="Gateway_1g3dybt" targetRef="Activity_17z1a6q" />\n    <bpmn2:sequenceFlow id="Flow_1tu1tg4" name="Yes" sourceRef="Gateway_1ucbubf" targetRef="Gateway_1g3dybt" />\n    <bpmn2:exclusiveGateway id="Gateway_0nbheze" name="Make another analysis?">\n      <bpmn2:incoming>Flow_1snozm1</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_0q4y4an</bpmn2:outgoing>\n      <bpmn2:outgoing>Flow_0u9vo5u</bpmn2:outgoing>\n    </bpmn2:exclusiveGateway>\n    <bpmn2:sequenceFlow id="Flow_0q4y4an" name="No" sourceRef="Gateway_0nbheze" targetRef="Gateway_0xb1dhn" />\n    <bpmn2:exclusiveGateway id="Gateway_1mtrfc3" name="Go to Data Analytics">\n      <bpmn2:incoming>Flow_1eyhqbc</bpmn2:incoming>\n      <bpmn2:incoming>Flow_0u9vo5u</bpmn2:incoming>\n      <bpmn2:incoming>Flow_0ts1gcc</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_0byalrt</bpmn2:outgoing>\n    </bpmn2:exclusiveGateway>\n    <bpmn2:sequenceFlow id="Flow_1eyhqbc" name="No" sourceRef="Gateway_1ucbubf" targetRef="Gateway_1mtrfc3" />\n    <bpmn2:sequenceFlow id="Flow_0byalrt" sourceRef="Gateway_1mtrfc3" targetRef="Activity_1psf12t" />\n    <bpmn2:sequenceFlow id="Flow_0u9vo5u" name="Yes" sourceRef="Gateway_0nbheze" targetRef="Gateway_1mtrfc3" />\n    <bpmn2:dataStoreReference id="DataObjectReference_0xqzh87" name="DataLake Data Storage" />\n    <bpmn2:sequenceFlow id="Flow_18thxxy" sourceRef="Activity_1psf12t" targetRef="Activity_1aoibqv" />\n    <bpmn2:sequenceFlow id="Flow_1snozm1" sourceRef="Activity_1aoibqv" targetRef="Gateway_0nbheze" />\n    <bpmn2:userTask id="Activity_1aoibqv" name="Review Variables">\n      <bpmn2:incoming>Flow_18thxxy</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_1snozm1</bpmn2:outgoing>\n    </bpmn2:userTask>\n    <bpmn2:sequenceFlow id="Flow_0ts1gcc" sourceRef="Gateway_1l3e80e" targetRef="Gateway_1mtrfc3" />\n    <bpmn2:sequenceFlow id="Flow_14hh9rc" sourceRef="Gateway_0xb1dhn" targetRef="Activity_10l1jpr" />\n    <bpmn2:sequenceFlow id="Flow_1pbasl1" sourceRef="Activity_10l1jpr" targetRef="Event_1b9zwmo" />\n    <bpmn2:callActivity id="Activity_10l1jpr" name="Demo 6">\n      <bpmn2:incoming>Flow_14hh9rc</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_1pbasl1</bpmn2:outgoing>\n    </bpmn2:callActivity>\n    <bpmn2:textAnnotation id="TextAnnotation_0kl8mf2">\n      <bpmn2:text>querybuilder</bpmn2:text>\n    </bpmn2:textAnnotation>\n    <bpmn2:association id="Association_1h5ihkw" sourceRef="Activity_0jngfnp" targetRef="TextAnnotation_0kl8mf2" />\n    <bpmn2:textAnnotation id="TextAnnotation_027x6t8">\n      <bpmn2:text>dataanalytics</bpmn2:text>\n    </bpmn2:textAnnotation>\n    <bpmn2:association id="Association_1arvrfv" sourceRef="Activity_1psf12t" targetRef="TextAnnotation_027x6t8" />\n  </bpmn2:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">\n      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">\n        <dc:Bounds x="302" y="-28" width="36" height="36" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_1gzuqjq_di" bpmnElement="Activity_17z1a6q">\n        <dc:Bounds x="500" y="50" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="DataObjectReference_19g0qyl_di" bpmnElement="DataObjectReference_19g0qyl">\n        <dc:Bounds x="652" y="175" width="36" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="629" y="232" width="83" height="27" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_0wj63n0_di" bpmnElement="Activity_0jngfnp">\n        <dc:Bounds x="730" y="-50" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Gateway_0oprz0e_di" bpmnElement="Gateway_0oprz0e" isMarkerVisible="true">\n        <dc:Bounds x="395" y="-35" width="50" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="425" y="-59" width="70" height="27" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Gateway_1l3e80e_di" bpmnElement="Gateway_1l3e80e" isMarkerVisible="true">\n        <dc:Bounds x="615" y="-35" width="50" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="563" y="-65" width="74" height="40" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Gateway_0xb1dhn_di" bpmnElement="Gateway_0xb1dhn" isMarkerVisible="true">\n        <dc:Bounds x="1585" y="-35" width="50" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="1615" y="3" width="90" height="53" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Event_1b9zwmo_di" bpmnElement="Event_1b9zwmo">\n        <dc:Bounds x="1862" y="-28" width="36" height="36" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="1849" y="-65.5" width="62" height="27" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_1qnst2d_di" bpmnElement="Activity_1psf12t">\n        <dc:Bounds x="1130" y="-50" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Gateway_1ucbubf_di" bpmnElement="Gateway_1ucbubf" isMarkerVisible="true">\n        <dc:Bounds x="895" y="-35" width="50" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="883" y="-80" width="74" height="40" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Gateway_1g3dybt_di" bpmnElement="Gateway_1g3dybt" isMarkerVisible="true">\n        <dc:Bounds x="395" y="65" width="50" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="303" y="80" width="74" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Gateway_0nbheze_di" bpmnElement="Gateway_0nbheze" isMarkerVisible="true">\n        <dc:Bounds x="1465" y="-35" width="50" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="1455" y="-72" width="69" height="27" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Gateway_1mtrfc3_di" bpmnElement="Gateway_1mtrfc3" isMarkerVisible="true">\n        <dc:Bounds x="1015" y="-35" width="50" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="1043" y="-59" width="54" height="27" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="DataStoreReference_0aij7qb_di" bpmnElement="DataObjectReference_0xqzh87">\n        <dc:Bounds x="455" y="195" width="50" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="443" y="157.5" width="74" height="27" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_1b7yj0d_di" bpmnElement="Activity_1aoibqv">\n        <dc:Bounds x="1300" y="-50" width="100" height="80" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_17aqbz2_di" bpmnElement="Activity_10l1jpr">\n        <dc:Bounds x="1700" y="60" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="TextAnnotation_0kl8mf2_di" bpmnElement="TextAnnotation_0kl8mf2">\n        <dc:Bounds x="815" y="-130" width="110" height="26" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="TextAnnotation_027x6t8_di" bpmnElement="TextAnnotation_027x6t8">\n        <dc:Bounds x="1070" y="-132" width="100" height="30" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNEdge id="DataInputAssociation_1h642dx_di" bpmnElement="DataInputAssociation_1h642dx">\n        <di:waypoint x="652" y="200" />\n        <di:waypoint x="570" y="200" />\n        <di:waypoint x="570" y="130" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="DataInputAssociation_0se651x_di" bpmnElement="DataInputAssociation_0se651x">\n        <di:waypoint x="505" y="220" />\n        <di:waypoint x="530" y="220" />\n        <di:waypoint x="530" y="130" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="DataOutputAssociation_0lsmnhs_di" bpmnElement="DataOutputAssociation_0lsmnhs">\n        <di:waypoint x="780" y="30" />\n        <di:waypoint x="780" y="200" />\n        <di:waypoint x="688" y="200" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0fxmrky_di" bpmnElement="Flow_0fxmrky">\n        <di:waypoint x="338" y="-10" />\n        <di:waypoint x="395" y="-10" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_1hpw9wu_di" bpmnElement="Flow_1hpw9wu">\n        <di:waypoint x="445" y="-10" />\n        <di:waypoint x="615" y="-10" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="523" y="-28" width="15" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_11kbaoo_di" bpmnElement="Flow_11kbaoo">\n        <di:waypoint x="600" y="90" />\n        <di:waypoint x="640" y="90" />\n        <di:waypoint x="640" y="15" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_18ulu43_di" bpmnElement="Flow_18ulu43">\n        <di:waypoint x="665" y="-10" />\n        <di:waypoint x="730" y="-10" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0a9yp4l_di" bpmnElement="Flow_0a9yp4l">\n        <di:waypoint x="1635" y="-10" />\n        <di:waypoint x="1862" y="-10" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="1734" y="-28" width="30" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_169etc3_di" bpmnElement="Flow_169etc3">\n        <di:waypoint x="1610" y="-35" />\n        <di:waypoint x="1610" y="-190" />\n        <di:waypoint x="420" y="-190" />\n        <di:waypoint x="420" y="-35" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="1623" y="-77" width="54" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_1vnyey2_di" bpmnElement="Flow_1vnyey2">\n        <di:waypoint x="830" y="-10" />\n        <di:waypoint x="895" y="-10" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0zdmjjo_di" bpmnElement="Flow_0zdmjjo">\n        <di:waypoint x="420" y="15" />\n        <di:waypoint x="420" y="65" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="426" y="29" width="18" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_00rwj4h_di" bpmnElement="Flow_00rwj4h">\n        <di:waypoint x="445" y="90" />\n        <di:waypoint x="500" y="90" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_1tu1tg4_di" bpmnElement="Flow_1tu1tg4">\n        <di:waypoint x="920" y="15" />\n        <di:waypoint x="920" y="280" />\n        <di:waypoint x="420" y="280" />\n        <di:waypoint x="420" y="115" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="931" y="43" width="18" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0q4y4an_di" bpmnElement="Flow_0q4y4an">\n        <di:waypoint x="1515" y="-10" />\n        <di:waypoint x="1585" y="-10" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="1543" y="-28" width="15" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_1eyhqbc_di" bpmnElement="Flow_1eyhqbc">\n        <di:waypoint x="945" y="-10" />\n        <di:waypoint x="1015" y="-10" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="973" y="-28" width="15" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0byalrt_di" bpmnElement="Flow_0byalrt">\n        <di:waypoint x="1065" y="-10" />\n        <di:waypoint x="1130" y="-10" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0u9vo5u_di" bpmnElement="Flow_0u9vo5u">\n        <di:waypoint x="1490" y="15" />\n        <di:waypoint x="1490" y="70" />\n        <di:waypoint x="1040" y="70" />\n        <di:waypoint x="1040" y="15" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="1501" y="29" width="18" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_18thxxy_di" bpmnElement="Flow_18thxxy">\n        <di:waypoint x="1230" y="-10" />\n        <di:waypoint x="1300" y="-10" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_1snozm1_di" bpmnElement="Flow_1snozm1">\n        <di:waypoint x="1400" y="-10" />\n        <di:waypoint x="1465" y="-10" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0ts1gcc_di" bpmnElement="Flow_0ts1gcc">\n        <di:waypoint x="640" y="-35" />\n        <di:waypoint x="640" y="-160" />\n        <di:waypoint x="1040" y="-160" />\n        <di:waypoint x="1040" y="-35" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_14hh9rc_di" bpmnElement="Flow_14hh9rc">\n        <di:waypoint x="1610" y="15" />\n        <di:waypoint x="1610" y="100" />\n        <di:waypoint x="1700" y="100" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_1pbasl1_di" bpmnElement="Flow_1pbasl1">\n        <di:waypoint x="1800" y="100" />\n        <di:waypoint x="1880" y="100" />\n        <di:waypoint x="1880" y="8" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Association_1h5ihkw_di" bpmnElement="Association_1h5ihkw">\n        <di:waypoint x="813" y="-50" />\n        <di:waypoint x="858" y="-104" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Association_1arvrfv_di" bpmnElement="Association_1arvrfv">\n        <di:waypoint x="1158" y="-50" />\n        <di:waypoint x="1128" y="-102" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="DataOutputAssociation_0ps3r04_di" bpmnElement="DataOutputAssociation_0ps3r04">\n        <di:waypoint x="1180" y="30" />\n        <di:waypoint x="1180" y="200" />\n        <di:waypoint x="688" y="200" />\n      </bpmndi:BPMNEdge>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn2:definitions>\n'
    else:
        raw_diagram_data[
            "xml_original"
        ] = '<?xml version="1.0" encoding="UTF-8"?>\n<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="sample-diagram" targetNamespace="http://bpmn.io/schema/bpmn" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd">\n  <bpmn2:process id="Process_1" isExecutable="false">\n    <bpmn2:startEvent id="StartEvent_1">\n      <bpmn2:outgoing>Flow_0j985y1</bpmn2:outgoing>\n    </bpmn2:startEvent>\n    <bpmn2:sequenceFlow id="Flow_0j985y1" sourceRef="StartEvent_1" targetRef="Activity_17z1a6q" />\n    <bpmn2:userTask id="Activity_17z1a6q" name="Get Data">\n      <bpmn2:incoming>Flow_0j985y1</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_0slvwa6</bpmn2:outgoing>\n      <bpmn2:property id="Property_01axr8m" name="__targetRef_placeholder" />\n      <bpmn2:dataInputAssociation id="DataInputAssociation_1h642dx">\n        <bpmn2:sourceRef>DataObjectReference_19g0qyl</bpmn2:sourceRef>\n        <bpmn2:targetRef>Property_01axr8m</bpmn2:targetRef>\n      </bpmn2:dataInputAssociation>\n    </bpmn2:userTask>\n    <bpmn2:sequenceFlow id="Flow_0slvwa6" sourceRef="Activity_17z1a6q" targetRef="Activity_0jngfnp" />\n    <bpmn2:sequenceFlow id="Flow_0m89608" sourceRef="Activity_0jngfnp" targetRef="Activity_1yr2yzs" />\n    <bpmn2:endEvent id="Event_0ue1epw" name="Success">\n      <bpmn2:incoming>Flow_0iofx8s</bpmn2:incoming>\n    </bpmn2:endEvent>\n    <bpmn2:sequenceFlow id="Flow_0iofx8s" sourceRef="Activity_1yr2yzs" targetRef="Event_0ue1epw" />\n    <bpmn2:receiveTask id="Activity_1yr2yzs" name="Wait for results (SNV model)">\n      <bpmn2:incoming>Flow_0m89608</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_0iofx8s</bpmn2:outgoing>\n      <bpmn2:dataOutputAssociation id="DataOutputAssociation_0wylqdr">\n        <bpmn2:targetRef>DataObjectReference_19g0qyl</bpmn2:targetRef>\n      </bpmn2:dataOutputAssociation>\n    </bpmn2:receiveTask>\n    <bpmn2:dataObjectReference id="DataObjectReference_19g0qyl" name="Data Lake Object Storage" dataObjectRef="DataObject_1ywy56n" />\n    <bpmn2:dataObject id="DataObject_1ywy56n" />\n    <bpmn2:sendTask id="Activity_0jngfnp" name="Train SVN regression algorithm">\n      <bpmn2:incoming>Flow_0slvwa6</bpmn2:incoming>\n      <bpmn2:outgoing>Flow_0m89608</bpmn2:outgoing>\n    </bpmn2:sendTask>\n    <bpmn2:textAnnotation id="TextAnnotation_0kl8mf2">\n      <bpmn2:text>regression/svn</bpmn2:text>\n    </bpmn2:textAnnotation>\n    <bpmn2:association id="Association_1h5ihkw" sourceRef="Activity_0jngfnp" targetRef="TextAnnotation_0kl8mf2" />\n  </bpmn2:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">\n      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">\n        <dc:Bounds x="412" y="240" width="36" height="36" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_1gzuqjq_di" bpmnElement="Activity_17z1a6q">\n        <dc:Bounds x="500" y="218" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Event_0ue1epw_di" bpmnElement="Event_0ue1epw">\n        <dc:Bounds x="982" y="240" width="36" height="36" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="979" y="283" width="43" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_1pmqlzh_di" bpmnElement="Activity_1yr2yzs">\n        <dc:Bounds x="820" y="218" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="DataObjectReference_19g0qyl_di" bpmnElement="DataObjectReference_19g0qyl">\n        <dc:Bounds x="692" y="355" width="36" height="50" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="667" y="412" width="86" height="27" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_0zgmewo_di" bpmnElement="Activity_0jngfnp">\n        <dc:Bounds x="660" y="218" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="TextAnnotation_0kl8mf2_di" bpmnElement="TextAnnotation_0kl8mf2">\n        <dc:Bounds x="760" y="130" width="110" height="41" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNEdge id="Flow_0j985y1_di" bpmnElement="Flow_0j985y1">\n        <di:waypoint x="448" y="258" />\n        <di:waypoint x="500" y="258" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="DataInputAssociation_1h642dx_di" bpmnElement="DataInputAssociation_1h642dx">\n        <di:waypoint x="692" y="380" />\n        <di:waypoint x="550" y="380" />\n        <di:waypoint x="550" y="298" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0slvwa6_di" bpmnElement="Flow_0slvwa6">\n        <di:waypoint x="600" y="258" />\n        <di:waypoint x="660" y="258" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0m89608_di" bpmnElement="Flow_0m89608">\n        <di:waypoint x="760" y="258" />\n        <di:waypoint x="820" y="258" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_0iofx8s_di" bpmnElement="Flow_0iofx8s">\n        <di:waypoint x="920" y="258" />\n        <di:waypoint x="982" y="258" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="DataOutputAssociation_0wylqdr_di" bpmnElement="DataOutputAssociation_0wylqdr">\n        <di:waypoint x="870" y="298" />\n        <di:waypoint x="870" y="380" />\n        <di:waypoint x="728" y="380" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Association_1h5ihkw_di" bpmnElement="Association_1h5ihkw">\n        <di:waypoint x="745" y="218" />\n        <di:waypoint x="787" y="171" />\n      </bpmndi:BPMNEdge>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn2:definitions>\n'
    [tasks, stores] = parse_xml(raw_diagram_data["xml_original"])
    is_template = random_bool()

    return name, description, tasks, stores, raw_diagram_data, is_template


def seed_workflow(db: Session) -> dict[str, dict, WorkflowModel]:
    (
        name,
        description,
        tasks,
        stores,
        raw_diagram_data,
        is_template,
    ) = create_random_workflow(0)
    category = seed_category(db)

    workflow_in = WorkflowCreate(
        category_id=category["obj"].id,
        name=name,
        description=description,
        tasks=tasks,
        raw_diagram_data=raw_diagram_data,
        is_template=is_template,
        settings={},
    )
    return {
        "category_id": category["obj"].id,
        "name": name,
        "description": description,
        "tasks": tasks,
        "stores": stores,
        "raw_diagram_data": raw_diagram_data,
        "is_template": is_template,
        "obj": WorkflowController.create(db=db, obj_in=workflow_in),
    }


def update_seed_workflow(
    db: Session, workflow_id: UUID
) -> dict[str, dict, WorkflowModel]:
    (
        _,
        description,
        tasks,
        stores,
        raw_diagram_data,
        is_template,
    ) = create_random_workflow(1)

    workflow_update = WorkflowUpdate(
        description=description,
        tasks=tasks,
        raw_diagram_data=raw_diagram_data,
        is_template=is_template,
        settings={},
    )
    return {
        "description": description,
        "tasks": tasks,
        "stores": stores,
        "raw_diagram_data": raw_diagram_data,
        "is_template": is_template,
        "obj": WorkflowController.update(
            db=db, resource_id=workflow_id, resource_in=workflow_update
        ),
    }


def remove_workflow(db: Session, workflow_id: UUID) -> tuple[WorkflowModel | None]:
    _ = WorkflowController.destroy(
        db=db,
        resource_id=workflow_id,
        resource_in=WorkflowUpdate(
            settings={},
        ),
    )
    try:
        workflow_validated = WorkflowController.read(
            db=db, resource_id=workflow_id, criteria={"deleted_at": None}
        )
    except:
        workflow_validated = None

    return workflow_validated
